#!/usr/bin/make -f

DIR=$(shell pwd)/debian/qmail-run

build: deb-checkdir build-stamp
build-stamp:
	touch build-stamp

clean: deb-checkdir deb-checkuid
	rm -rf '$(DIR)'
	rm -f build-stamp
	rm -f debian/files

install: deb-checkdir deb-checkuid build-stamp
	rm -rf '$(DIR)'
	$(MAKE) install DESTDIR='$(DIR)'
	install -d -m0755 '$(DIR)'/etc/init.d
	ln -s qmail-sendmail '$(DIR)'/usr/sbin/sendmail
	ln -s qmail-sendmail '$(DIR)'/usr/sbin/mailq
	install -d -m0755 '$(DIR)'/usr/lib
	ln -s ../sbin/sendmail '$(DIR)'/usr/lib/sendmail
	install -d -m0755 '$(DIR)'/var/lib/qmail/bin
	ln -s /usr/bin/qmailctl '$(DIR)'/var/lib/qmail/bin/qmailctl
	install -d -m0755 '$(DIR)'/var/lib/qmail/supervise
	ln -s /etc/qmail/qmail-send '$(DIR)'/var/lib/qmail/supervise/
	ln -s /etc/qmail/qmail-smtpd '$(DIR)'/var/lib/qmail/supervise/
	# man pages
	install -d -m0755 '$(DIR)'/usr/share/man/man8
	install -m0644 man/tcprules-smtp.8 '$(DIR)'/usr/share/man/man8/
	gzip -9 '$(DIR)'/usr/share/man/man8/tcprules-smtp.8

binary-arch:

binary-indep: install qmail-run.deb
	dpkg-gencontrol -isp -pqmail-run -P'$(DIR)'
	dpkg -b '$(DIR)' ..

binary: binary-indep binary-arch

.PHONY: build clean install binary-indep binary-arch binary

include debian/implicit
